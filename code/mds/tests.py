from gf2m import *

square_mat = [
		[0x02, 0x01, 0x01, 0x03],
		[0x03, 0x02, 0x01, 0x01],
		[0x01, 0x03, 0x02, 0x01],
		[0x01, 0x01, 0x03, 0x02]
	]
	
square_mat_inv = [
		[0x0e, 0x09, 0x0d, 0x0b],
		[0x0b, 0x0e, 0x09, 0x0d],
		[0x0d, 0x0b, 0x0e, 0x09],
		[0x09, 0x0d, 0x0b, 0x0e]
	]

shark_mat = [
		[0xce, 0x95, 0x57, 0x82, 0x8a, 0x19, 0xb0, 0x01],
		[0xe7, 0xfe, 0x05, 0xd2, 0x52, 0xc1, 0x88, 0xf1],
		[0xb9, 0xda, 0x4d, 0xd1, 0x9e, 0x17, 0x83, 0x86],
		[0xd0, 0x9d, 0x26, 0x2c, 0x5d, 0x9f, 0x6d, 0x75],
		[0x52, 0xa9, 0x07, 0x6c, 0xb9, 0x8f, 0x70, 0x17],
		[0x87, 0x28, 0x3a, 0x5a, 0xf4, 0x33, 0x0b, 0x6c],
		[0x74, 0x51, 0x15, 0xcf, 0x09, 0xa4, 0x62, 0x09],
		[0x0b, 0x31, 0x7f, 0x86, 0xbe, 0x05, 0x83, 0x34]
	]
	
shark_mat_inv = [
		[0xe7, 0x30, 0x90, 0x85, 0xd0, 0x4b, 0x91, 0x41],
		[0x53, 0x95, 0x9b, 0xa5, 0x96, 0xbc, 0xa1, 0x68],
		[0x02, 0x45, 0xf7, 0x65, 0x5c, 0x1f, 0xb6, 0x52],
		[0xa2, 0xca, 0x22, 0x94, 0x44, 0x63, 0x2a, 0xa2],
		[0xfc, 0x67, 0x8e, 0x10, 0x29, 0x75, 0x85, 0x71],
		[0x24, 0x45, 0xa2, 0xcf, 0x2f, 0x22, 0xc1, 0x0e],
		[0xa1, 0xf1, 0x71, 0x40, 0x91, 0x27, 0x18, 0xa5],
		[0x56, 0xf4, 0xaf, 0x32, 0xd2, 0xa4, 0xdc, 0x71]
	]

tavares_mat = [
    [0x93, 0x13, 0x57, 0xda, 0x58, 0x47, 0x0c, 0x1f],
    [0x13, 0x93, 0xda, 0x57, 0x47, 0x58, 0x1f, 0x0c],
    [0x57, 0xda, 0x93, 0x13, 0x0c, 0x1f, 0x58, 0x47],
    [0xda, 0x57, 0x13, 0x93, 0x1f, 0x0c, 0x47, 0x58],
    [0x58, 0x47, 0x0c, 0x1f, 0x93, 0x13, 0x57, 0xda],
    [0x47, 0x58, 0x1f, 0x0c, 0x13, 0x93, 0xda, 0x57],
    [0x0c, 0x1f, 0x58, 0x47, 0x57, 0xda, 0x93, 0x13],
    [0x1f, 0x0c, 0x47, 0x58, 0xda, 0x57, 0x13, 0x93]
]

khazad_mat = [
    [0x01, 0x03, 0x04, 0x05, 0x06, 0x08, 0x0b, 0x07],
    [0x03, 0x01, 0x05, 0x04, 0x08, 0x06, 0x07, 0x0b],
    [0x04, 0x05, 0x01, 0x03, 0x0b, 0x07, 0x06, 0x08],
    [0x05, 0x04, 0x03, 0x01, 0x07, 0x0b, 0x08, 0x06],
    [0x06, 0x08, 0x0b, 0x07, 0x01, 0x03, 0x04, 0x05],
    [0x08, 0x06, 0x07, 0x0b, 0x03, 0x01, 0x05, 0x04],
    [0x0b, 0x07, 0x06, 0x08, 0x04, 0x05, 0x01, 0x03],
    [0x07, 0x0b, 0x08, 0x06, 0x05, 0x04, 0x03, 0x01]
]

anubis_mat = [
    [0x01, 0x02, 0x04, 0x06],
    [0x02, 0x01, 0x06, 0x04],
    [0x04, 0x06, 0x01, 0x02],
    [0x06, 0x04, 0x02, 0x01]
]

rijndael_mat = [
    [0x02, 0x03, 0x01, 0x01],
    [0x01, 0x02, 0x03, 0x01],
    [0x01, 0x01, 0x02, 0x03],
    [0x03, 0x01, 0x01, 0x02]
]

rijndael_mat_inv = [
    [0x0e, 0x0b, 0x0d, 0x09],
    [0x09, 0x0e, 0x0b, 0x0d],
    [0x0d, 0x09, 0x0e, 0x0b],
    [0x0b, 0x0d, 0x09, 0x0e]
]

bksq_mat = [
    [3, 2, 2],
    [2, 3, 2],
    [2, 2, 3]
]

# hierocrypt 3

mds = [
  [0xc4, 0x65, 0xc8, 0x8b],
  [0x8b, 0xc4, 0x65, 0xc8],
  [0xc8, 0x8b, 0xc4, 0x65],
  [0x65, 0xc8, 0x8b, 0xc4]
]

mds_inv = [
  [0x82, 0xc4, 0x34, 0xf6],
  [0xf6, 0x82, 0xc4, 0x34],
  [0x34, 0xf6, 0x82, 0xc4],
  [0xc4, 0x34, 0xf6, 0x82]
]

mdsh = [
  [0x5, 0x5, 0xa, 0xe],
  [0xe, 0x5, 0x5, 0xa],
  [0xa, 0xe, 0x5, 0x5],
  [0x5, 0xa, 0xe, 0x5]
]

mdsh_inv = [
  [0xb, 0xe, 0xe, 0x6],
  [0x6, 0xb, 0xe, 0xe],
  [0xe, 0x6, 0xb, 0xe],
  [0xe, 0xe, 0x6, 0xb]
]

# hierocrypt l1

l1_mdsh = [
  [0x5, 0x7],
  [0xa, 0xb]
]

l1_mdsh_inv = [
  [0xc, 0xa],
  [0x5, 0xb]
]

def get_hierocrypt_cost():
    print(mds)
    print(matrix_xtime_cost(mds, 4), 'xtime')
    print(matrix_xor_cost(mds, 4), 'xor')
    print('inversa')
    print(mds_inv)
    print(matrix_xtime_cost(mds_inv, 4), 'xtime')
    print(matrix_xor_cost(mds_inv, 4), 'xor')
    
def get_hierocrypt_higher_cost():
    print(matrix_xor_cost(mdsh, 4), 'xor')
    print(matrix_xor_cost(mdsh_inv, 4), 'xor')
    print(matrix_xtime_cost(mdsh, 4), 'xtime')
    print(matrix_xtime_cost(mdsh_inv, 4), 'xtime')
    print("for L1")
    print(matrix_xor_cost(l1_mdsh, 2), 'xor')
    print(matrix_xor_cost(l1_mdsh_inv, 2), 'xor')
    print(matrix_xtime_cost(l1_mdsh, 2), 'xtime')
    print(matrix_xtime_cost(l1_mdsh_inv, 2), 'xtime')

def get_inverse_bksq():
    init_discrete_log()
    print(bin(IRREDUCIBLE_POLY))
    inverse = invert_matrix(bksq_mat, 3)
    print("inversa")
    print(inverse)
    print("mul")
    print(matrix_multiplication(bksq_mat, inverse, 3))
    print(matrix_xtime_cost(inverse, 3), 'xtime')
    print(matrix_xor_cost(inverse, 3), 'xor')

def get_inverse_khazad():
    print(matrix_multiplication(khazad_mat, khazad_mat, 8))
    #assert(khazad_mat == inverse)

def get_costs():
    print("xtime")
    print("tavares", matrix_xtime_cost(tavares_mat, 8))
    print("khazad", matrix_xtime_cost(khazad_mat, 8))
    print("anubis", matrix_xtime_cost(anubis_mat, 4))
    print("rijndael", matrix_xtime_cost(rijndael_mat, 4))
    print("rijndael inv", matrix_xtime_cost(rijndael_mat_inv, 4))
    print("bksq", matrix_xtime_cost(bksq_mat, 3))
    
    print("xor")
    print("tavares", matrix_xor_cost(tavares_mat, 8))
    print("khazad", matrix_xor_cost(khazad_mat, 8))
    print("anubis", matrix_xor_cost(anubis_mat, 4))
    print("rijndael", matrix_xor_cost(rijndael_mat, 4))
    print("rijndael inv", matrix_xor_cost(rijndael_mat_inv, 4))
    print("bksq", matrix_xor_cost(bksq_mat, 3))

def test_xtime_cost():
    print(matrix_xtime_cost(square_mat, 4))
    print(matrix_xtime_cost(shark_mat, 8))

def test_xor_cost():
    print(matrix_xor_cost(square_mat, 4))
    print(matrix_xor_cost(shark_mat, 8))

def test_mat_mul():
    print(matrix_multiplication(square_mat, square_mat_inv, 4))
    print(matrix_multiplication(shark_mat, shark_mat_inv, 8))

def test_det():
    print(get_determinant(square_mat, 4))
    print(get_determinant(shark_mat, 8))

def test_inv():
    print(invert_matrix(square_mat, 4))
    print(square_mat_inv)
    print(invert_matrix(shark_mat, 8))
    print(shark_mat_inv)

def test_is_mds():
    print(is_mds(square_mat, 4))
    print(is_mds(square_mat_inv, 4))
    print(is_mds(shark_mat, 8))
    print(is_mds(shark_mat_inv, 8))
    
    not_mds = [
    		[0xe7, 0x30, 0x90, 0x85, 0xd0, 0x4b, 0x91, 0x41],
    		[0x53, 0x95, 0x9b, 0xa5, 0x96, 0xbc, 0xa1, 0x68],
    		[0x02, 0x45, 0xf7, 0x65, 0x5c, 0x1f, 0xb6, 0x52],
    		[0xa2, 0xca, 0x22, 0x94, 0x44, 0x63, 0x00, 0xa2],
    		[0xfc, 0x67, 0x8e, 0x10, 0x29, 0x75, 0x85, 0x71],
    		[0x24, 0x45, 0xa2, 0xcf, 0x2f, 0x22, 0xc1, 0x0e],
    		[0xa1, 0xf1, 0x71, 0x40, 0x91, 0x27, 0x18, 0xa5],
    		[0x56, 0xf4, 0xaf, 0x32, 0xd2, 0xa4, 0xdc, 0x71]
    	]
    
    print(is_mds(not_mds, 8))


def print_mat_hex(m):
    for i in range(len(m)):
        row = []
        for j in range(len(m)):
            row.append(hex(m[i][j]))
        print(row)

#test_xtime_cost()
#test_xor_cost()
#test_mat_mul()
#test_det()
#test_inv()

#get_costs()
#get_inverse_bksq()
get_hierocrypt_higher_cost()